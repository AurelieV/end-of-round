<div class="header">
    <div class="first-line">
        <div class="title">{{(zone$ | async)?.name}}</div>
        <div class="actions">
            <zone-message [zone]="zone$ | async"></zone-message>
            <button mat-icon-button 
                class="menu-button"
                [matMenuTriggerFor]="params"
            ><mat-icon>&#xE5D4;</mat-icon></button>
        </div>
    </div>
    <mat-menu #params="matMenu">
        <button mat-menu-item (click)="addTime()">
            <mat-icon>&#xE856;</mat-icon>
            <span>Add time</span>
        </button>
        <button mat-menu-item (click)="assign()">
            <mat-icon>&#xE851;</mat-icon>
            <span>Assign judge</span>
        </button>
        <button mat-menu-item (click)="allGreen()" *ngIf="!(isOnOutstandingsStep$ | async)">
            <mat-icon>&#xE877;</mat-icon>
            <span>Mark all empty as done</span>
        </button>
        <button mat-menu-item (click)="seeHelp()">
            <mat-icon>&#xE887;</mat-icon>
            <span>Display help</span>
        </button>
    </mat-menu>
    <div class="filters" *ngIf="!(isOnOutstandingsStep$ | async)">
        <mat-slide-toggle
            color="primary"
            [checked]="(filter$ | async).onlyPlaying"
            (change)="toggleOnlyPlaying($event.checked)"><span>Display only playing</span>
        </mat-slide-toggle>
        <mat-slide-toggle
            color="primary"
            [checked]="(filter$ | async).onlyExtraTime"
            (change)="toggleOnlyExtraTime($event.checked)"><span>Display only extra time</span>
        </mat-slide-toggle>
    </div>
</div>
<div class="tables" [class.hide-button]="!(isOnOutstandingsStep$ | async)" [class.show-warn]="(isOnOutstandingsStep$ | async)" [class.high-padding]="!(isOnOutstandingsStep$ | async)">
    <loader [isLoading]="isLoading"></loader>
    <div class="table block" *ngFor="let table of tables$ | async" [ngClass]="[table.status, table.result ? '' : table.doneTime | warnAgo]" [class.has-time]="table.time" (click)="onTableClick(table)">
        <div class="number">{{table.number}}</div>
        <div class="time" *ngIf="table.time">{{table.time}}min</div>
        <div class="result">{{table.result | result }}</div>
        <div class="assignated" *ngIf="table.assignated">{{table.assignated}}</div>
        <div class="actions">
            <button mat-raised-button color="primary" (click)="addResult($event, table)">Add result</button>
        </div>
    </div>
</div>
<div class="message" *ngIf="(tables$ | async)?.length === 0">
    No tables.
    <span *ngIf="isOnOutstandingsStep$ | async"><br/>your team leader have all result</span>
    <span *ngIf="!(isOnOutstandingsStep$ | async)"><br/>If this is not normal, check your filters</span>
</div>

<button *ngIf="zoneId && !(zone$ | async)?.needHelp" mat-fab color="primary" class="call-help" (click)="callHelp(true)"><mat-icon>&#xE91F;</mat-icon></button>
<button *ngIf="zoneId && (zone$ | async)?.needHelp" mat-fab color="warn" class="call-help" (click)="callHelp(false)"><mat-icon>&#xE14C;</mat-icon></button>

<ng-template #confirm>
    <div class="confirmation">
        <h3>Are you sure</h3>
        <div mat-dialog-content>
            All current empty tables (white) will become done (green). Filters will NOT be taken in account.
        </div>
        <div class="actions" mat-dialog-actions>
            <button mat-raised-button color="warn" (click)="cancelAllGreen()">Cancel</button>
            <button mat-raised-button color="primary" (click)="confirmAllGreen()">Go</button>
        </div>
    </div>
</ng-template>

<ng-template #assignJudges>
    <div class="assign-judges">
        <h3>Assign judge</h3>
        <div mat-dialog-content>
            <form #assignJudgesForm="ngForm">
                <mat-input-container>
                    <input maxLength="4" name="judge" matInput placeholder="Judge" type="text" required [(ngModel)]="assignData.judge">
                </mat-input-container>
                <textarea required type="text" [(ngModel)]="assignData.tables" name="tables" placeholder="Tables number separated by space or newline"></textarea>
            </form>
        </div>
        <div class="actions" mat-dialog-actions>
            <button mat-raised-button color="warn" (click)="cancelAssignJudges()">Close</button>
            <button mat-raised-button color="primary" [disabled]="!assignJudgesForm.form.valid" (click)="confirmAssignJudges(assignJudgesForm)">Assign</button>
        </div>
    </div>
</ng-template>
<ng-template #help>
    <div class="help">
        <h3>Reminder</h3>
        <div mat-dialog-content>
            <div class="text playing">Playing</div>
            <div class="text covered">Covered</div>
            <div class="text done">Done (no body at the table)</div>
            <div class="text featured">Featured</div>
        </div>
    </div>
</ng-template>